<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="google" content="notranslate" />

  <title>botanist</title>

  <link rel="canonical" href="https://aequologica.net/sto.html" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    #bo table>thead>tr>th {
      font-size: smaller;
    }

    #bo table>tbody>tr>td {
      vertical-align: top;
    }

    #bo table>tbody>tr>td div {
      display: block;
    }

    #bo table tr> :nth-child(2) {
      max-width: 40px;
    }

    #bo table tr> :nth-child(2)>img {
      min-width: 80px;
    }

    #bo table tr> :nth-child(3),
    #bo table tr> :nth-child(4) {
      text-align: right;
    }

    #bo table>tbody>tr>td:nth-child(5) {
      max-width: 12rem;
    }

    #bo table>tbody>tr>td:nth-child(6) {
      max-width: 16rem;
    }

    #bo table>tbody>tr>td:nth-child(6) img {
      display: block;
      min-width: 240px;
      width: 100%;
      height: auto;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@latest/lodash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/nunjucks@latest/browser/nunjucks.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@latest/moment.min.js"></script>

  <script>

    $(document).ready(() => {
      const bo = {
        'prol√©gom√®nes': { arm: "‚àÖ", mea: 2, dur: 11, tex: "Blank, bare, empty, plain." },
        'A': { arm: "‚ôØ‚ôØ‚ôØ", mea: 12, dur: 33, tex: "Memories, remembrance, recollection." },
        'B': { arm: "‚ô≠‚ô≠‚ô≠", mea: 12, dur: 33, tex: "Idem, but stronger, more vivid." },
        'A¬≤': { arm: "‚ôØ‚ôØ‚ôØ", mea: 12, dur: 33, tex: "Decision to act." },
        'B¬≤': { arm: "‚ô≠‚ô≠‚ô≠", mea: 13, dur: 36, tex: "Decision to act even more." },
        'A¬≥': { arm: "‚ôØ‚ôØ‚ôØ", mea: 11, dur: 30, tex: "Renouncement, surrendering, giving up." },
        'd√©veloppement': { arm: "‚àÖ", mea: 16, dur: 44, tex: "Await, suspense, rising turmoil." },
        'B¬≥': { arm: "‚ô≠‚ô≠‚ô≠", mea: 13, dur: 36, tex: "Awakening, \"f‚Ä¶, something has to be done!\"" },
        'A‚Å¥': { arm: "‚ôØ‚ôØ‚ôØ", mea: 9, dur: 25, tex: "Pleasant melancholy, saudade." },
        'p√©roraison': { arm: "‚ôØ‚ôØ‚ôØ‚ôØ", mea: 6, dur: 17, tex: "Last surge, final attempt." },
        'coda': { arm: "‚ôØ‚ôØ", mea: 2, dur: 11, tex: "All's well that ends well." },
        'fin': { arm: "", mea: 0, dur: 0, tex: "Really ? (<i>is G‚ôÆ asking</i> üòâ)" }
      }

      const final = {
        'prol√©gom√®nes': [{ "kittyBack": "00‚Ä≤00‚Ä≥" }],
        'A': [{ "megaCloseup": "00‚Ä≤07‚Ä≥" }, { "cordes": "00‚Ä≤22‚Ä≥" }, { "lessMegaCloseup": "00‚Ä≤33‚Ä≥" }],
        'B': [{ "kittyFrontTightShotFromRight": "00‚Ä≤42‚Ä≥" }, { "roues": "00‚Ä≤57‚Ä≥" }, { "kittyFrontMediumShotFromRight": "01‚Ä≤08‚Ä≥" }],
        'A¬≤': [{ "kittySideMediumShotFromLeft": "01‚Ä≤17‚Ä≥" }, { "cordesBassesHorizontales": "01‚Ä≤31‚Ä≥" }, { "closeright": "01‚Ä≤41‚Ä≥" }],
        'B¬≤': [{ "fullPianoFromSouthEast": "01‚Ä≤50‚Ä≥" }, { "pedales2": "02‚Ä≤00‚Ä≥" }, { "right": "02‚Ä≤00‚Ä≥" }],
        'A¬≥': [{ "counterDiveFromWestSouth": "02‚Ä≤30‚Ä≥" }, { "marteauxInside": "02‚Ä≤43‚Ä≥" }, { "bottom": "02‚Ä≤53‚Ä≥" }],
        'd√©veloppement': [
          { "bottom": "02‚Ä≤59‚Ä≥" },
          { "leggio": "03‚Ä≤04‚Ä≥" },
          { "verticalDiveOnKeyboard": "03‚Ä≤09‚Ä≥" },
          { "verticalDiveOnKeyboard2": "03‚Ä≤20‚Ä≥" },
          { "verticalDiveOnKeyboard3": "03‚Ä≤28‚Ä≥" },
          { "verticalDiveOnKeyboard4": "03‚Ä≤33‚Ä≥" },
          { "verticalDiveOnKeyboard5": "03‚Ä≤39‚Ä≥" },
        ],
        'B¬≥': [
          { "longShotCircleRightToLeft1": "03‚Ä≤42‚Ä≥" },
          { "longShotCircleRightToLeft2": "03‚Ä≤48‚Ä≥" },
          { "longShotCircleRightToLeft3": "03‚Ä≤52‚Ä≥" },
          { "longShotCircleRightToLeft4": "03‚Ä≤57‚Ä≥" },
          { "longShotCircleRightToLeft5FullBehind": "04‚Ä≤00‚Ä≥" },
          { "longShotCircleRightToLeft6": "04‚Ä≤04‚Ä≥" },
          { "longShotCircleRightToLeft7": "04‚Ä≤07‚Ä≥" },
          { "longShotCircleRightToLeft8": "04‚Ä≤10‚Ä≥" },
          { "longShotCircleRightToLeft9": "04‚Ä≤13‚Ä≥" },
          { "longShotCircleRightToLeft10": "04‚Ä≤16‚Ä≥" },
        ],
        'A‚Å¥': [{ "horizontalFromWestSouth": "04‚Ä≤23‚Ä≥" }, { "diveOnSeatFromWestNorth": "04‚Ä≤39‚Ä≥" }],
        'p√©roraison': [{ "kittyAndPianoAmericanPlanSideFromRight": "04‚Ä≤51‚Ä≥" }, { "mediumEast": "04‚Ä≤58‚Ä≥" }],
        'coda': [{ "kittyEnd": "05‚Ä≤04‚Ä≥" }],
        'fin': [{ "_": "05‚Ä≤21‚Ä≥" }],

      }

      $("#bo thead")
        .append($("<tr>")
          .append($("<th>").text("Part"))
          .append($("<th>").text("Key"))
          .append($("<th>").text("Measures"))
          /* .append($("<th>").text("d√©but")) */
          .append($("<th>").text("duration"))
          .append($("<th>").html("Directions"))
          .append($("<th>").html("Shots"))
        )

      let sum = 0
      let secs = 0
      let i = 0

      // https://stackoverflow.com/a/17772086/1070215
      function isString(x) {
        return Object.prototype.toString.call(x) === "[object String]"
      }
      let prevDuration = undefined
      let tdDuration = undefined
      _.forOwn(bo, (value, key) => {
        sum = sum + parseFloat(value.mea)
        secs = secs + parseInt(value.dur)

        const $div = $('<div>')

        if (final[key]) {
          let first_time_since_start = undefined
          final[key].forEach((shot) => {
            const [ima] = Object.keys(shot)
            const time_since_start = shot[ima]
            if (!first_time_since_start) {
              first_time_since_start = time_since_start
            }
            $div.append($('<div>').addClass('time_since_start').text(time_since_start))
            if (ima !== "_") {
              const $img = $('<div>').append($('<img>')
                .addClass('img-fluid img-thumbnail')
                .attr('src', 'pianos/' + ima + '.jpg'))
              $div.append($img)
            }
          })
          if (tdDuration && first_time_since_start) {
            let prev = 0;
            if (prevDuration) {
              prev = prevDuration
            }
            const A = moment(first_time_since_start, "mm‚Ä≤ss‚Ä≥")
            const B = moment(prev, "mm‚Ä≤ss‚Ä≥")
            const AminusB = A.diff(B) / 1000
            tdDuration.html(`${AminusB}‚Ä≥`)
            prevDuration = first_time_since_start
          }
        }

        tdDuration = $("<td>");
        $("#bo tbody")
          .append($("<tr>")
            .append($("<td>").text(key))
            .append($("<td>").html(value.arm ? $('<img class="img-fluid">').attr("src", `pianos/lilyponds/${encodeURIComponent(value.arm)}.svg`) : ""))
            .append($("<td>").text(value.mea ? value.mea : ""))
            .append(tdDuration)
            .append($("<td>").html(value.tex))
            .append($("<td>").html($div))
          )
        i = i + 1
      })

      $("#bo tbody tr:last-child td:nth-child(3)").html($("<b>").text(sum.toFixed(0)))
    })
  </script>
</head>

<body>
  <main id="bo" class="container">
    <table class="table table-responsive table-striped">
      <thead></thead>
      <tbody></tbody>
    </table>
  </main>
</body>

</html>