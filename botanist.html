<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="google" content="notranslate" />

  <title>botanist</title>

  <link rel="canonical" href="https://aequologica.net/sto.html" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/css/bootstrap.min.css" rel="stylesheet" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&display=swap" rel="stylesheet">

  <!-- https://www.schemecolor.com/beautiful-light-pastels-color-scheme.php 
    #FDDFDF Misty Rose
    #FCF7DE Cornsilk
    #DEFDE0 Nyanza
    #DEF3FD Water
    #F0DEFD Lavender

    https://www.schemecolor.com/light-pastel-gradient.php
    #C0DFF7 Beau Blue
    #CDE4F5 Azureish White
    #D9E8F3 Azureish White
    #E6EDF2 Bright Gray
    #F2F1F0 Anti-Flash White
    #FFF6EE Seashell
    
    https://www.schemecolor.com/light-red-green-gradient.php
    #FCBABA Melon
    #FFCCCB Light Red
    #FCF6E1 Old Lace
    #E4F2D5 Eggshell
    #CBE8BE Tea Green
    #B1D9A3 Light Moss Green
  -->

  <style>
    body {
      font-family: 'Caveat', cursive;
      font-size: 20pt;
    }

    #chapters table>tbody>tr:nth-child(1) {
      background-color: #FCF6E160;
    }

    #chapters table>tbody>tr:nth-child(2),
    #chapters table>tbody>tr:nth-child(4),
    #chapters table>tbody>tr:nth-child(6),
    #chapters table>tbody>tr:nth-child(9) {
      background-color: #E4F2D560;
    }

    #chapters table>tbody>tr:nth-child(3),
    #chapters table>tbody>tr:nth-child(5),
    #chapters table>tbody>tr:nth-child(8) {
      background-color: #B1D9A360;
    }

    #chapters table>tbody>tr:nth-child(7) {
      background-color: #FCBABA60;
    }

    #chapters table>tbody>tr:nth-child(10) {
      background-color: #FFCCCB60;
    }

    #chapters table>tbody>tr:nth-child(11) {
      background-color: #E4F2D560;
    }

    #chapters table>tbody>tr>td {
      vertical-align: top;
    }

    #chapters table>tbody>tr>td div {
      display: block;
    }

    #chapters table tr> :nth-child(2)>div {
      max-width: 60px;
      height: 50px;
    }

    #chapters table tr> :nth-child(2)>div>img {
      width: 60px;
      height: 50px;
      object-fit: none;
      object-position: 0 0;
    }

    #chapters table tr> :nth-child(3),
    #chapters table tr> :nth-child(4) {
      text-align: center;
    }

    #chapters table>tbody>tr>td:nth-child(5) {
      max-width: 12rem;
    }

    #chapters table>tbody>tr>td:nth-child(6) {
      max-width: 16rem;
      padding: 0;
    }

    #chapters table>thead>tr>th:nth-child(6),
    #chapters table>tbody>tr>td:nth-child(6) div.time_since_start:first-child {
      padding: 8px 8px 8px 0;
    }

    #chapters table>tbody>tr>td:nth-child(6) img {
      display: block;
      min-width: 240px;
      width: 100%;
      height: auto;
      padding-right: 8px;
    }

    #chapters table>tbody>tr:last-child {
      font-weight: bold;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@latest/lodash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/nunjucks@latest/browser/nunjucks.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@latest/moment.min.js"></script>

  <script>
    $(document).ready(() => {
      const columns = [
        "Part",
        "Key",
        "Measures",
        "Duration",
        "Clue",
        "Shooting script"
      ]

      /* beautify ignore:start */
      const chapters = {
        'Prolégomènes' : { keySignature: "∅"   , measures:  2, html: "Blank. Bare. Empty." },
        'Thèse'        : { keySignature: "♯♯♯" , measures: 12, html: "Memories, remembrance, recollection." },
        'Antithèse'    : { keySignature: "♭♭♭" , measures: 12, html: "Ditto, stronger, more vivid." },
        'Thèse′'       : { keySignature: "♯♯♯" , measures: 12, html: "Decision to act." },
        'Antithèse′'   : { keySignature: "♭♭♭" , measures: 13, html: "Action." },
        'Thèse″'       : { keySignature: "♯♯♯" , measures: 11, html: "Renouncement, surrendering, giving up." },
        'Développement': { keySignature: "∅"   , measures: 16, html: "Await, suspense, rising turmoil." },
        'Antithèse″'   : { keySignature: "♭♭♭" , measures: 13, html: "Awakening, \"f…, something has to be done!\"" },
        'Thèse‴'       : { keySignature: "♯♯♯" , measures:  9, html: "Pleasant melancholy, saudade." },
        'Péroraison'   : { keySignature: "♯♯♯♯", measures:  6, html: "Last surge, final attempt." },
        'Conclusion'   : { keySignature: "♯♯"  , measures:  3, html: "All's well that ends well." },
        'fin'          : { keySignature: ""    , measures:  0, html: "" }
      }

      const shootingScript = {
        'Prolégomènes': [{ "kittyBack"                   : "00′00″" }],
        'Thèse'       : [{ "megaCloseup"                 : "00′07″" }, { "cordes"                  : "00′22″" }, { "lessMegaCloseup"              : "00′33″" }],
        'Antithèse'   : [{ "kittyFrontTightShotFromRight": "00′42″" }, { "roues2"                  : "00′57″" }, { "kittyFrontMediumShotFromRight": "01′08″" }],
        'Thèse′'      : [{ "kittySideMediumShotFromLeft" : "01′17″" }, { "cordesBassesHorizontales": "01′31″" }, { "closeright"                   : "01′41″" }],
        'Antithèse′'  : [{ "fullPianoFromSouthEast"      : "01′50″" }, { "pedales2"                : "02′05″" }, { "right"                        : "02′18″" }],
        'Thèse″'      : [{ "counterDiveFromWestSouth"    : "02′30″" }, { "marteauxInside"          : "02′43″" }, { "bottomTop"                    : "02′53″" }],
        'Développement': [
          { "bottomTopBottom": "02′59″" },
          { "leggio": "03′04″" },
          { "verticalDiveOnKeyboard": "03′09″" },
          { "verticalDiveOnKeyboard2": "03′20″" },
          { "verticalDiveOnKeyboard3": "03′28″" },
          { "verticalDiveOnKeyboard4": "03′33″" },
          { "verticalDiveOnKeyboard5": "03′39″" },
        ],
        'Antithèse″': [
          { "longShotCircleRightToLeft": "03′42″" },
          { "longShotCircleRightToLeft2": "03′48″" },
          { "longShotCircleRightToLeft3": "03′52″" },
          { "longShotCircleRightToLeft4": "03′57″" },
          { "longShotCircleRightToLeft5": "04′00″" },
          { "longShotCircleRightToLeft6": "04′04″" },
          { "longShotCircleRightToLeft7": "04′07″" },
          { "longShotCircleRightToLeft8": "04′10″" },
          { "longShotCircleRightToLeft9": "04′13″" },
          { "longShotCircleRightToLeft10": "04′16″" },
        ],
        'Thèse‴'    : [{ "longShotCircleRightToLeft13"           : "04′23″" }, { "diveOnSeatFromWestNorth": "04′39″" }],
        'Péroraison': [{ "kittyAndPianoAmericanPlanSideFromRight": "04′51″" }, { "mediumEast"             : "04′58″" }],
        'Conclusion': [{ "kittyEnd"                              : "05′04″" }],
        'fin'       : [{ "_"                                     : "05′21″" }],
      }
      /* beautify ignore:end */

      $("#chapters table thead")
        .append($("<tr>")
          .append($("<th>").text("Part"))
          .append($("<th>").text("Key"))
          .append($("<th>").text("Measures"))
          .append($("<th>").text("Duration"))
          .append($("<th>").html("Clue"))
          .append($("<th>").html("Shooting script"))
        )

      let sum = 0

      // https://stackoverflow.com/a/17772086/1070215
      function isString(x) {
        return Object.prototype.toString.call(x) === "[object String]"
      }
      let prevDuration = undefined
      let tdDuration = undefined
      let lastImageName = undefined
      let noTime = false
      _.forOwn(chapters, (value, key) => {
        sum = sum + parseFloat(value.measures)

        const $lastColDiv = $('<div>')

        if (shootingScript[key]) {
          let first_time_since_start = undefined
          shootingScript[key].forEach((shot) => {
            const [imageName] = Object.keys(shot)
            if (lastImageName) {
              noTime = imageName.startsWith(lastImageName)
            }
            if (!noTime) {
              lastImageName = imageName
            }
            const time_since_start = shot[imageName]
            if (!first_time_since_start) {
              first_time_since_start = time_since_start
            }
            if (!noTime) {
              $lastColDiv.append($('<div>').addClass('time_since_start').text(time_since_start))
            }
            if (imageName !== "_") {
              const $img = $('<div>').append($('<img>')
                .addClass('img-fluid')
                .attr('src', 'pianos/' + imageName + '.jpg'))
              $lastColDiv.append($img)
            }
          })
          if (tdDuration && first_time_since_start) {
            let prev = 0;
            if (prevDuration) {
              prev = prevDuration
            }
            const S = moment(prev, "mm′ss″")
            const E = moment(first_time_since_start, "mm′ss″")
            const EminusS = E.diff(S) / 1000
            tdDuration.html(`${EminusS}″`)
            prevDuration = first_time_since_start
          }
        }

        function hasUpperCase(str) {
          return str && str.toLowerCase() !== str;
        }

        tdDuration = $("<td>");
        $("#chapters tbody")
          .append($("<tr>")
            .append($("<td>").html(hasUpperCase(key) ? $('<h1>').text(key) : ""))
            .append($("<td>").html(value.keySignature ?
              $('<div>').append($('<img>').attr("src", `pianos/lilyponds/${encodeURIComponent(value.keySignature)}.svg`)) :
              ""))
            .append($("<td>").text(value.measures ? value.measures : ""))
            .append(tdDuration)
            .append($("<td>").html(value.html))
            .append($("<td>").html($lastColDiv))
          )
      })

      $("#chapters tbody tr:last-child td:nth-child(3)").html(sum.toFixed(0))
    })
  </script>
</head>

<body>
  <main id="chapters" class="container-lg p-0">
    <table class="table table-responsive table-borderless">
      <!-- table-striped -->
      <thead></thead>
      <tbody></tbody>
    </table>
  </main>
</body>

</html>