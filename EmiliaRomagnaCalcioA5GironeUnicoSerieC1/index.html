<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Forme des équipes</title>

<link   type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"                      rel="stylesheet">
<link   type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"                    rel="stylesheet">
<link   type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/tooltipster/3.3.0/css/tooltipster.min.css"                 rel="stylesheet">
<link   type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/tooltipster/3.3.0/css/themes/tooltipster-light.min.css"    rel="stylesheet">
        
<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">

<style type="text/css">
body {
    margin: 2rem;
    font-family: 'Montserrat', serif;
    font-size: 18px;
}
section {
    display: flex;
    flex-wrap: wrap;
    max-width: 1024px;
}
section > div.row {
    width: 100%;
}
section > div.row:hover {
    background-color: #efefef;
}
section > div.row > div.col {
    display: flex;
}
section > div.row > div.col > img.logo {
    max-width: 28px;
    max-height:28px;
    margin-right: .5rem;
}

section > div.row > div.col > span.points {
    font-family: monospace; 
    margin-right: 1rem;
}

section > div.row > div.col > span.dotted-line {
  white-space: nowrap;
  overflow: hidden;
}
section > div.row > div.col > span.dotted-line:after {
  content: " . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .";
  word-spacing: 6px;
  color: rgba(128, 128, 128, 0.4);
}
section > div.row > div.col > span.plays {
    font-size: 14px;
    white-space:nowrap;
    margin-left: .5rem;
}
section > div.row > div.col > span.plays i.play {
    margin: .2rem .3rem;
    padding: .3rem .2rem;
}
section > div.row > div.col > span.plays i:nth-child(3) {
    border-right: 1px solid gray;
    padding-right: 1rem;
}
.win {
    color:green;
}
.draw {
    color:gray;
}
.lose {
    color:red;
}
.unknown {
    color:white;
}

#tooltip_content {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 12px 20px 14px;
    text-align: left;
    white-space: nowrap;
    z-index: 2;
    background: #fff;
    box-shadow: 0px 0px 4px 0px rgba(0,0,0,0.33);
}
#tooltip_content .intro {
    display: block;
    line-height: 17px;
    font-size: 14px;
    font-weight: bold;
    color: #7c8699;
}
#tooltip_content .winner {
    font-weight: bold;
}
#tooltip_content .content {
    overflow: hidden;
    display: block;
    margin: 2px 0 0;
    padding: 9px 0 0;
    border-top: solid 1px #d4dae6;
    line-height: 25px;
}
#tooltip_content .score-block {
    display: inline-block;
    margin: 0 4px;
    vertical-align: top;
}
#tooltip_content .score {
    display: inline-block;
    min-width: 26px;
    padding: 4px 0 3px;
    line-height: 19px;
    font-size: 16px;
    font-weight: bold;
    text-align: center;
    vertical-align: top;
    color: #7c8699;
    background: #e9eef5;
    border-radius: 2px;
}
#tooltip_content .team-logo {
    width: 20px;
    height: auto;
}
</style>
</head>
<body class="container-fluid">

<section>
</section>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tooltipster/3.3.0/js/jquery.tooltipster.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.6/handlebars.min.js"></script>

<script id="row-template" type="text/x-handlebars-template">
    <div class="row" id="{{key}}">
        <div class="col">
            <img class="logo img-fluid img-thumbnail" src="images/{{value.id}}.png">
            <span class="points">{{value.points}}</span>
            <span class="dotted-line">{{value.name}}</span>
            <span class="plays">
            {{#each value.plays}}
                <i class="play fa fa-circle {{color}}" aria-hidden="true" data-x="{{x}}"></i>
            {{/each}}
            </span>
        </div>
    </div>
</script>

<script id="pop-template" type="text/x-handlebars-template">
  <span id="tooltip_content">
    <span class="intro">{{title}}</span>
    {{#with match}}
    <span class="content">
      {{#with home}}
      <span class="team-name {{clazz}}">{{team}}</span>
      <img class="team-logo" src="images/{{logo}}.png" alt="{{team}}">
      <span class="score-block">
        <span class="score ">{{goals}}</span>
      {{/with}}
      {{#with visiting}}
        <span class="score winner">{{goals}}</span>
      </span>
      <img class="team-logo" src="images/{{logo}}.png" alt="{{team}}">
      <span class="team-name {{clazz}}">{{team}}</span>
      {{/with}}
    </span>
    {{/with}}
  </span>
</script>

<script type="text/javascript">

var days = [{
  title: "9° giornata (26 novembre 2016)", 
  matches: [
    { homeTeam: { id:"AssClubC5"             , goals:6 }, visitingTeam: { id:"ProPatriaSFelice"   , goals:4 }, },
    { homeTeam: { id:"Cavezzo"               , goals:1 }, visitingTeam: { id:"RiminiC5"           , goals:0 }, },
    { homeTeam: { id:"FutsalPonteRodoni"     , goals:6 }, visitingTeam: { id:"OsteriaGrandeC5"    , goals:3 }, },
    { homeTeam: { id:"FutsalReggioEmilia"    , goals:7 }, visitingTeam: { id:"Fossolo76Calcio"    , goals:3 }, },
    { homeTeam: { id:"GianLucaMontanari"     , goals:3 }, visitingTeam: { id:"RealCasalgrandese"  , goals:3 }, },
    { homeTeam: { id:"SantAgataFutsal2004"   , goals:8 }, visitingTeam: { id:"Aposa"              , goals:4 }, },
  ], 
}, {
  title: "10° giornata (03 dicembre 2016)",
  matches: [
    {homeTeam: { id:"Fossolo76Calcio", goals:5}, visitingTeam: { id:"Aposa", goals:1},},
    {homeTeam: { id:"FutsalPonteRodoni", goals:2}, visitingTeam: { id:"Cavezzo", goals:1},},
    {homeTeam: { id:"OsteriaGrandeC5", goals:3}, visitingTeam: { id:"AssClubC5", goals:0},},
    {homeTeam: { id:"ProPatriaSFelice", goals:3}, visitingTeam: { id:"GianLucaMontanari", goals:2},},
    {homeTeam: { id:"RealCasalgrandese", goals:2}, visitingTeam: { id:"FutsalReggioEmilia", goals:1},},
    {homeTeam: { id:"RiminiC5", goals:2}, visitingTeam: { id:"SantAgataFutsal2004", goals:7},},
  ],
}, {
  title: "11° giornata (10 dicembre 2016)",
  matches: [
    {homeTeam: { id:"Aposa", goals:4}, visitingTeam: { id:"ProPatriaSFelice", goals:2},},
    {homeTeam: { id:"AssClubC5", goals:1}, visitingTeam: { id:"RiminiC5", goals:1},},
    {homeTeam: { id:"Cavezzo", goals:6}, visitingTeam: { id:"RealCasalgrandese", goals:4},},
    {homeTeam: { id:"FutsalReggioEmilia", goals:0}, visitingTeam: { id:"OsteriaGrandeC5", goals:0},},
    {homeTeam: { id:"GianLucaMontanari", goals:0}, visitingTeam: { id:"FutsalPonteRodoni", goals:4},},
    {homeTeam: { id:"SantAgataFutsal2004", goals:7}, visitingTeam: { id:"Fossolo76Calcio", goals:4},},
  ],
}, {
  title: "12° giornata (14 gennaio 2017)",
  matches: [
    {homeTeam: { id:"Aposa", goals:1}, visitingTeam: { id:"OsteriaGrandeC5", goals:2},},
    {homeTeam: { id:"AssClubC5", goals:6}, visitingTeam: { id:"FutsalPonteRodoni", goals:1},},
    {homeTeam: { id:"FutsalReggioEmilia", goals:3}, visitingTeam: { id:"Cavezzo", goals:3},},
    {homeTeam: { id:"GianLucaMontanari", goals:1}, visitingTeam: { id:"Fossolo76Calcio", goals:1},},
    {homeTeam: { id:"ProPatriaSFelice", goals:7}, visitingTeam: { id:"RiminiC5", goals:2},},
    {homeTeam: { id:"SantAgataFutsal2004", goals:6}, visitingTeam: { id:"RealCasalgrandese", goals:5},},
  ],
}, {
  title: "13° giornata (21 gennaio 2017)",
  matches: [
    {homeTeam: { id:"Cavezzo", goals:7}, visitingTeam: { id:"GianLucaMontanari", goals:4},},
    {homeTeam: { id:"Fossolo76Calcio", goals:3}, visitingTeam: { id:"ProPatriaSFelice", goals:2},},
    {homeTeam: { id:"FutsalPonteRodoni", goals:0}, visitingTeam: { id:"FutsalReggioEmilia", goals:3},},
    {homeTeam: { id:"OsteriaGrandeC5", goals:4}, visitingTeam: { id:"SantAgataFutsal2004", goals:1},},
    {homeTeam: { id:"RealCasalgrandese", goals:5}, visitingTeam: { id:"AssClubC5", goals:3},},
    {homeTeam: { id:"RiminiC5", goals:7}, visitingTeam: { id:"Aposa", goals:2},},
  ],
}, {
  title: "14° giornata (28 gennaio 2017)",
  matches: [
    {homeTeam: { id:"Aposa", goals:3}, visitingTeam: { id:"RealCasalgrandese", goals:5},},
    {homeTeam: { id:"AssClubC5", goals:2}, visitingTeam: { id:"Cavezzo", goals:3},},
    {homeTeam: { id:"Fossolo76Calcio", goals:2}, visitingTeam: { id:"RiminiC5", goals:2},},
    {homeTeam: { id:"FutsalReggioEmilia", goals:3}, visitingTeam: { id:"GianLucaMontanari", goals:3},},
    {homeTeam: { id:"ProPatriaSFelice", goals:5}, visitingTeam: { id:"OsteriaGrandeC5", goals:4},},
    {homeTeam: { id:"SantAgataFutsal2004", goals:6}, visitingTeam: { id:"FutsalPonteRodoni", goals:4},},
  ],
}, {
  title: "15° giornata (4 febbraio 2017)",
  matches: [
    {homeTeam: { id:"Cavezzo", goals:3}, visitingTeam: { id:"Aposa", goals:2},},
    {homeTeam: { id:"FutsalPonteRodoni", goals:6}, visitingTeam: { id:"ProPatriaSFelice", goals:5},},
    {homeTeam: { id:"FutsalReggioEmilia", goals:3}, visitingTeam: { id:"SantAgataFutsal2004", goals:7},},
    {homeTeam: { id:"GianLucaMontanari", goals:8}, visitingTeam: { id:"AssClubC5", goals:0},},
    {homeTeam: { id:"OsteriaGrandeC5", goals:5}, visitingTeam: { id:"RiminiC5", goals:3},},
    {homeTeam: { id:"RealCasalgrandese", goals:4}, visitingTeam: { id:"Fossolo76Calcio", goals:5},},
  ],
}];

var full_table = {
/* 01 */ SantAgataFutsal2004 : { id: "1025311", name: "Sant Agata Futsal 2004", classement:  1, points: 31, plays: [] },
/* 02 */ OsteriaGrandeC5     : { id: "1012511", name: "Osteria Grande C5",      classement:  2, points: 27, plays: [] },
/* 03 */ Cavezzo             : { id: "1012444", name: "Cavezzo",                classement:  3, points: 24, plays: [] },
/* 04 */ RealCasalgrandese   : { id: "1012446", name: "Real Casalgrandese",     classement:  4, points: 23, plays: [] },
/* 05 */ GianLucaMontanari   : { id: "1025721", name: "Gian Luca Montanari",    classement:  5, points: 21, plays: [] },
/* 06 */ AssClubC5           : { id: "1025227", name: "Ass. Club C5",           classement:  6, points: 20, plays: [] },
/* 07 */ RiminiC5            : { id: "1012437", name: "Rimini C5",              classement:  7, points: 19, plays: [] },
/* 08 */ Fossolo76Calcio     : { id: "1012512", name: "Fossolo 76 Calcio",      classement:  8, points: 19, plays: [] },
/* 09 */ FutsalPonteRodoni   : { id: "1012441", name: "Futsal Ponte Rodoni",    classement:  9, points: 19, plays: [] },
/* 10 */ FutsalReggioEmilia  : { id: "1025223", name: "Futsal Reggio Emilia",   classement: 10, points: 18, plays: [] },
/* 11 */ ProPatriaSFelice    : { id: "1012455", name: "Pro Patria S. Felice",   classement: 11, points: 15, plays: [] },
/* 12 */ Aposa               : { id: "1012435", name: "Aposa",                  classement: 12, points: 12, plays: [] },
};

// massage data
(function(){
  // clone matches into full_table plays
  _.forEach(days, function(day, x) {
    _.forEach(day.matches, function(match) {
      full_table[match.homeTeam.id].plays[x] = _.cloneDeep(match);
      full_table[match.visitingTeam.id].plays[x] = _.cloneDeep(match);
    });
  });

  // insert [win (1) | draw ("x") | lose (2) | unknown] classes
  _.forOwn(full_table, function(value, key) { 
    _.forEach(value.plays, function(play) {
      var _1x2 = "";
      if ($.isNumeric(play.homeTeam.goals) && $.isNumeric(play.visitingTeam.goals)) {
        if (play.homeTeam.goals > play.visitingTeam.goals) {
          _1x2 = "1";
        } else if (play.homeTeam.goals == play.visitingTeam.goals) {
          _1x2 = "x";
        } else {
          _1x2 = "2";
        }
      }
      if (play.homeTeam.id == key) {
        play.color = (_1x2=="1" ? "win" : (_1x2=="x" ? "draw" : (_1x2=="2" ? "lose" : "unknown")));
      } else {
        play.color = (_1x2=="2" ? "win" : (_1x2=="x" ? "draw" : (_1x2=="1" ? "lose" : "unknown")));
      }
    });
  });
})();

jQuery(document).ready(function($) {

    // insert teams into DOM
    (function(){
      // compile handlebars template
      var row_template = Handlebars.compile($("#row-template").html());
      var $rows = [];
      _.forOwn(full_table, function(value, key) { 
        $rows.push(row_template({value:value, key:key}));
      });
      $sorted = _.sortBy($rows, [function (row) {
        classement = parseInt(full_table[$(row).attr('id')].classement);
        return classement;
      }]);
      $('section').append($sorted);
    })();

    // setup popovers
    (function(){
      // compile handlebars template
      var pop_template = Handlebars.compile($("#pop-template").html());

      $("body > section > div.row").each(function (index, row) {
        var teamId = $(row).prop('id');
        $(row).find("div.col > span.plays > i.play").each(function (index, value) {
          var match  = full_table[teamId].plays[index];
          if (match) {
            var massaged = {
              home : {
                team    : full_table[match.homeTeam.id].name,
                logo    : full_table[match.homeTeam.id].id,
                goals   : match.homeTeam.goals,
                clazz   : (match.homeTeam.goals > match.visitingTeam.goals ? "winner" : "") 
              },
              visiting : {
                team    : full_table[match.visitingTeam.id].name,
                logo    : full_table[match.visitingTeam.id].id,
                goals   : match.visitingTeam.goals,
                clazz   : (match.visitingTeam.goals > match.homeTeam.goals ? "winner" : "") 
              },
            };
  
            $(value).tooltipster({
              content: pop_template({
                title: days[index % days.length].title,
                match: massaged,
              }),
              contentAsHTML: true,
              contentCloning: true,
              theme: 'tooltipster-light',
              delay: 0,
            });
          } // match exists
        }); // each i
      }); // each row
    })();

  });

</script>
</body>
</html>
