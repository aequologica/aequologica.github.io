<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <meta name="viewport"             content="width=device-width, initial-scale=1">
  <meta name="google"               content="notranslate">
  <meta name="description"          content="">
  <meta name="author"               content="cthiebaud">

  <meta http-equiv="Content-Language" content="en" />
  <meta http-equiv="X-UA-Compatible"  content="IE=edge,chrome=1">  

  <meta property="og:title"         content="Christophe Thiebaud Index"/>
  <meta property="og:description"   content="Useful links"/>
  <meta property="og:image"         content="/images/beh-semi-trans.png"/>
  <meta property="og:type"          content="website"/>

  <title>æquologica</title>

  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  
  <link rel="stylesheet" type="text/css" href="style.css" >

  <link rel="shortcut icon" href="favicon2.ico">

</head>
<body ng-app="aequologicaApp" ng-controller="IndexCtrl">

  <img id="loadinfo" class="loading-image" src="ajax-loader.gif" ng-show="!done" />

  <div  masonry 
        id="masonry" 
        ng-click="shuffle()">
    <div class="masonry-brick"
         ng-repeat="brick in bricks" 
         ng-if="!outOfOffice || !(brick.url.indexOf('sap.corp')!=-1)">
      <a  ng-show="brick.src" 
          ng-href="{{brick.url}}" 
          target="{{brick.name}}" 
          ng-click="$event.stopPropagation();"
          ng-class="{'internal': brick.url.indexOf('sap.corp')!=-1}">
        <img ng-src = "images/{{brick.src}}">
      </a>
      <ul ng-show="brick.items" class="text-wrap">
        <li ng-repeat="item in brick.items"
            ng-if="!outOfOffice || !(item.url.indexOf('sap.corp')!=-1) || item.type">
          <a target="{{item.name}}" 
             ng-show="item.url" 
             ng-href="{{item.url}}" 
             ng-click="$event.stopPropagation();"
             ng-class="{'internal': item.url.indexOf('sap.corp')!=-1}">
            {{item.text}}
          </a>
          <hr ng-show="item.type"/>
        </li>
      </ul>
    </div>
  </div>

<!-- 

insert disqus.txt here 

-->

</body>

</html>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js" ></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"             ></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"           ></script>
<script type="text/javascript" src="http://masonry.desandro.com/masonry.pkgd.min.js"                         ></script>
<script type="text/javascript" src="http://imagesloaded.desandro.com/imagesloaded.pkgd.min.js"               ></script>
<script type="text/javascript" src="http://code.angularjs.org/1.2.14/angular.min.js"                         ></script>
<script type="text/javascript" src="http://passy.github.io/angular-masonry/angular-masonry.min.js"           ></script>

<script type="text/javascript" >
'use strict';

// http://stackoverflow.com/questions/20789373/shuffle-array-in-ng-repeat-angular
// -> Fisher–Yates shuffle algorithm
var shuffleArray = function(array) {
  var m = array.length, t, i;

  // While there remain elements to shuffle
  while (m) {
    // Pick a remaining element…
    i = Math.floor(Math.random() * m--);

    // And swap it with the current element.
    t = array[m];
    array[m] = array[i];
    array[i] = t;
  }

  return array;
}


angular.module( 'aequologicaApp', ['wu.masonry'])
  .config(['$httpProvider', function($httpProvider) {
    // http://stackoverflow.com/questions/16098430/angular-ie-caching-issue-for-http
    //initialize get if not there
    if (!$httpProvider.defaults.headers.get) {
        $httpProvider.defaults.headers.get = {};    
    }
    //disable IE ajax request caching
    $httpProvider.defaults.headers.get['If-Modified-Since'] = '0';
  }])
  .controller( 'IndexCtrl', function ($scope, $http) {
    $scope.done     = false;
    $scope.bricks   = [];
    $scope.shuffle  = function () {
      $scope.bricks = shuffleArray($scope.bricks);
    }

    var image = new Image();
    image.src = 'https://sapneth3.wdf.sap.corp/~sapdownload/011000358700000178722013E';
    setTimeout( function() {

        if ( !image.complete || !image.naturalWidth ) {
          $scope.outOfOffice = true; 
        } else {
            $scope.outOfOffice = false; 
        }

        $http.get('index.json', { cache: false}).success( function(data) {
          _.each(data.images, function(image){
            $scope.bricks.push(image);
          });
          _.each(data.groups, function(group){
            $scope.bricks.push(group);
          });

          $scope.bricks = shuffleArray($scope.bricks);
          $scope.done = true;
        });

    }, 2000 );    

});

// http://4loc.wordpress.com/2009/04/28/documentready-vs-windowload/
$(window).load(function() {
  $('.masonry-brick').show();
});

</script>
